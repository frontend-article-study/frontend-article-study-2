# Reactì˜ ì´ë²¤íŠ¸ ê´€ë¦¬

## ì„œë¡ 
ë¦¬ì•¡íŠ¸ ê°œë°œì„ í•˜ë©° onClickì´ë²¤íŠ¸ì˜ ì—ëŸ¬ëŠ” ì™œ ì—ëŸ¬ë°”ìš´ë”ë¦¬ì— ì•ˆì¡íˆì§€? ì—ì„œ ë¦¬ì•¡íŠ¸ ì´ë²¤íŠ¸ì— ëŒ€í•œ ì´í•´ë„ê°€ ì—†ë‹¤ëŠ” ê²ƒì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤. ì‚¬ì‹¤ í”„ë ˆì„ì›Œí¬, ë¼ì´ë¸ŒëŸ¬ë¦¬ ê³µë¶€ì— ëŒ€í•´ì„œ íšŒì˜ì ì´ì–´ì„œ ì´ê¸´ í–ˆëŠ”ë° ì‚¬ìš© ì¤‘ ì´í•´ê°€ ì•ˆë˜ëŠ” ë¶€ë¶„ì€ ë„ˆë¬´ ì°ì°í•˜ì—¬ ë‹¤ì‹œ ë¦¬ì•¡íŠ¸ë¥¼ ë°”ë¼ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ì£¼ì œëŠ” ë¦¬ì•¡íŠ¸ì˜ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤.

## ë¦¬ì•¡íŠ¸ì˜ ì´ë²¤íŠ¸ ê´€ë¦¬ ê°œë…
ReactëŠ” ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ root ì—˜ë¦¬ë¨¼íŠ¸ ë ˆë²¨ì—ì„œ ë‹¨ì¼ ë¦¬ìŠ¤ë„ˆë¡œ ì²˜ë¦¬í•˜ëŠ” ì´ë²¤íŠ¸ ìœ„ì„ íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
React 17ë¶€í„°ëŠ” documentê°€ ì•„ë‹Œ root ì»¨í…Œì´ë„ˆì— ì´ë²¤íŠ¸ë¥¼ ì—°ê²°í•˜ì—¬ Reactì˜ í˜¸í™˜ì„±ì„ í–¥ìƒ ì‹œì¼°ê³ , SyntheticEvent ì‹œìŠ¤í…œì„ í†µí•´ ë¸Œë¼ìš°ì € ê°„ ì¼ê´€ëœ ë™ì‘ì„ ë³´ì¥í•˜ë©´ì„œë„, React 17ì—ì„œ ì´ë²¤íŠ¸ í’€ë§ì„ ì œê±°í•˜ì—¬ ê°œë°œì ê²½í—˜ì„ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤.

## ì´ë²¤íŠ¸ ìœ„ì„ì˜ ê°œë…ê³¼ Reactì˜ ì±„íƒ ì´ìœ 

ì´ë²¤íŠ¸ ìœ„ì„(Event Delegation)ì€ DOMì˜ ì´ë²¤íŠ¸ ì „íŒŒ ë©”ì»¤ë‹ˆì¦˜ì„ í™œìš©í•˜ëŠ” JavaScriptì˜ ê¸°ë³¸ íŒ¨í„´ìœ¼ë¡œ ì—¬ëŸ¬ ìì‹ ìš”ì†Œì— ê°œë³„ ë¦¬ìŠ¤ë„ˆë¥¼ ë¶™ì´ëŠ” ëŒ€ì‹ , ë¶€ëª¨ ìš”ì†Œì— ë‹¨ì¼ ë¦¬ìŠ¤ë„ˆë¥¼ ì—°ê²°í•˜ì—¬ ëª¨ë“  ìì‹ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ìº¡ì³, íƒ€ê²Ÿ, ë²„ë¸”ë§ 3ê°€ì§€ ë‹¨ê³„ë¡œ ì „íŒŒë©ë‹ˆë‹¤.
ìº¡ì²˜ ë‹¨ê³„ : document => target
íƒ€ê²Ÿ ë‹¨ê³„ : target
ë²„ë¸”ë§ ë‹¨ê³„ : target => document

Reactê°€ ì´ë²¤íŠ¸ ìœ„ì„ì„ ì±„íƒí•œ ì´ìœ 
React ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì¢…ì¢… ìˆ˜ì²œ ê°œì˜ ì¸í„°ë™í‹°ë¸Œ ìš”ì†Œë¥¼ í¬í•¨í•˜ëŠ”ë°, ê° ìš”ì†Œì— ê°œë³„ ë¦¬ìŠ¤ë„ˆë¥¼ ì—°ê²°í•˜ë©´ ë©”ëª¨ë¦¬ ì†Œë¹„ê°€ ê¸‰ê²©íˆ ì¦ê°€í•©ë‹ˆë‹¤.
ì´ë²¤íŠ¸ ìœ„ì„ì„ í†µí•´ ì´ë²¤íŠ¸ íƒ€ì…ë‹¹ ë‹¨ í•˜ë‚˜ì˜ ë¦¬ìŠ¤ë„ˆë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ O(n)ì˜ ë©”ëª¨ë¦¬ ë³µì¡ë„ë¥¼ O(1)ë¡œ ì¤„ì…ë‹ˆë‹¤. ë˜í•œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ë„ ìë™ìœ¼ë¡œ ì´ë²¤íŠ¸ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë©°, í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì € í˜¸í™˜ì„±ê³¼ ì¼ê´€ëœ ì´ë²¤íŠ¸ ë™ì‘ì„ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Reactì˜ ì´ë²¤íŠ¸ ìœ„ì„ì„ êµ¬í˜„í•œë‹¤ë©´.

```javascript
// ìœ„ì„ ì—†ì´ - ì—¬ëŸ¬ ê°œì˜ ë¦¬ìŠ¤ë„ˆ
document.getElementById('button1').addEventListener('click', handler);
document.getElementById('button2').addEventListener('click', handler);

// ìœ„ì„ ì‚¬ìš© - ë‹¨ì¼ ë¦¬ìŠ¤ë„ˆ
document.getElementById('parent').addEventListener('click', function(event) {
  if (event.target.matches('button')) {
    handler(event);
  }
});
```

## Reactì˜ ì´ë²¤íŠ¸ ìœ„ì„ êµ¬í˜„ ë©”ì»¤ë‹ˆì¦˜

Reactì˜ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì€ ë„¤ì´í‹°ë¸Œ DOM ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©°, React 16ê¹Œì§€ëŠ” ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ document ë ˆë²¨ì— ì—°ê²°í–ˆì§€ë§Œ, React 17ë¶€í„°ëŠ” root ì»¨í…Œì´ë„ˆì— ì—°ê²°í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.

ì´ë²¤íŠ¸ íë¦„
ì´ë²¤íŠ¸ íë¦„ì€ ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ë„¤ì´í‹°ë¸Œ DOM ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ê³ , ì´ ì´ë²¤íŠ¸ëŠ” ë²„ë¸”ë§ì„ í†µí•´ Reactì˜ root ë¦¬ìŠ¤ë„ˆì— ë„ë‹¬í•©ë‹ˆë‹¤.
ReactëŠ” event.targetì„ í†µí•´ ì–´ë–¤ React ì»´í¬ë„ŒíŠ¸ê°€ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ”ì§€ ê²°ì •í•˜ê³ , ë„¤ì´í‹°ë¸Œ ì´ë²¤íŠ¸ë¥¼ SyntheticEvent ê°ì²´ë¡œ ë˜í•‘í•˜ì—¬ í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì € í˜¸í™˜ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```jsx
function Button() {
  const handleClick = (syntheticEvent) => {
    console.log('React í•¸ë“¤ëŸ¬ í˜¸ì¶œë¨');
    console.log(syntheticEvent.nativeEvent); // ì›ë³¸ DOM ì´ë²¤íŠ¸ ì ‘ê·¼
  };

  return <button onClick={handleClick}>í´ë¦­í•˜ì„¸ìš”</button>;
}
```

1. ë²„íŠ¼ í´ë¦­
2. JS ì´ë²¤íŠ¸ ë°œìƒ
3. JS ì´ë²¤íŠ¸ ë²„ë¸”ë§ ì§„í–‰ -> root ë„ë‹¬
4. rootì—ì„œ Reactê°€ ì´ë²¤íŠ¸ë¥¼ ì¸í„°ì…‰íŠ¸
5. Reactê°€ SyntheticEvent ìƒì„±
6. handleClickì´ SyntheticEventì™€ í•¨ê»˜ í˜¸ì¶œë¨

ReactëŠ” ë Œë”ë§ ì¤‘ì— JSX ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ë§Œë‚˜ë©´ í•´ë‹¹ ì´ë²¤íŠ¸ íƒ€ì…ì— ëŒ€í•œ ë¦¬ìŠ¤ë„ˆë¥¼ rootì— ë“±ë¡í•˜ê³ , ì»´í¬ë„ŒíŠ¸ì˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ë‚´ë¶€ ë°ì´í„° êµ¬ì¡°ì— ì €ì¥í•©ë‹ˆë‹¤. ì‹¤ì œ DOM ìš”ì†Œì—ëŠ” ì–´ë–¤ ë¦¬ìŠ¤ë„ˆë„ ì—°ê²°ë˜ì§€ ì•Šìœ¼ë©°, ëª¨ë“  ì´ë²¤íŠ¸ëŠ” rootì—ì„œ ì¤‘ì•™ ì§‘ì¤‘ì‹ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
- í¬ì¸íŠ¸ : ì‹¤ì œ DOMì˜ ìº¡ì³,ë²„ë¸”ë§ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ.

## SyntheticEvent ì‹œìŠ¤í…œì˜ ì—­í• ê³¼ êµ¬ì¡°

SyntheticEventëŠ” ë„¤ì´í‹°ë¸Œ ë¸Œë¼ìš°ì € ì´ë²¤íŠ¸ë¥¼ ê°ì‹¸ëŠ” í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì € ë˜í¼ì…ë‹ˆë‹¤. W3C ëª…ì„¸ë¥¼ ë”°ë¥´ëŠ” ì¼ê´€ëœ APIë¥¼ ì œê³µí•˜ì—¬ ë¸Œë¼ìš°ì € ê°„ ì°¨ì´ë¥¼ ì¶”ìƒí™”í•©ë‹ˆë‹¤. 
ëª¨ë“  SyntheticEvent ê°ì²´ëŠ” bubbles, cancelable, currentTarget, target, preventDefault(), stopPropagation() ë“±ì˜ í‘œì¤€í™”ëœ ì†ì„±ê³¼ ë©”ì„œë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

SyntheticEventëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì •ê·œí™”ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. onMouseLeaveëŠ” ë„¤ì´í‹°ë¸Œ mouseout ì´ë²¤íŠ¸ë¡œ ë§¤í•‘ë˜ê³ , onFocus/onBlurëŠ” focusin/focusoutì„ ì‚¬ìš©í•˜ì—¬ ì¼ê´€ëœ ë™ì‘ì„ ë³´ì¥í•©ë‹ˆë‹¤. í‚¤ë³´ë“œ ì´ë²¤íŠ¸ì˜ ê²½ìš° keyCode, which, charCodeë¥¼ ì •ê·œí™”í•˜ë©°, Internet Explorerì˜ srcElementë¥¼ targetìœ¼ë¡œ ë§¤í•‘í•˜ëŠ” ë“± ë¸Œë¼ìš°ì €ë³„ íŠ¹ìˆ˜ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

```javascript
// SyntheticEventì˜ í‘œì¤€ ì†ì„±
{
  bubbles: boolean,
  cancelable: boolean,
  currentTarget: DOMEventTarget,  // í•¸ë“¤ëŸ¬ê°€ ë“±ë¡ëœ ìš”ì†Œ
  defaultPrevented: boolean,
  eventPhase: number,
  isTrusted: boolean,
  nativeEvent: DOMEvent,          // ì›ë³¸ ë¸Œë¼ìš°ì € ì´ë²¤íŠ¸
  preventDefault: Function,
  stopPropagation: Function,
  target: DOMEventTarget,         // ì´ë²¤íŠ¸ë¥¼ íŠ¸ë¦¬ê±°í•œ ìš”ì†Œ
  timeStamp: number,
  type: string
}
```

ì´ëŸ¬í•œ ì •ê·œí™” ë ˆì´ì–´ëŠ” ìµœì†Œí•œì˜ ì˜¤ë²„í—¤ë“œë§Œ ì¶”ê°€í•˜ë©´ì„œë„ í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì € ì´ë²¤íŠ¸ ì²˜ë¦¬ë¥¼ ìœ„í•œ ì»¤ìŠ¤í…€ ì½”ë“œ ì‘ì„± í•„ìš”ì„±ì„ ì™„ì „íˆ ì œê±°í•©ë‹ˆë‹¤. ë²ˆë“¤ í¬ê¸° ì˜í–¥ì€ ì•½ 0.7%ì— ë¶ˆê³¼í•˜ë©°, ëŸ°íƒ€ì„ ì„±ëŠ¥ ì˜í–¥ì€ í˜„ëŒ€ ë¸Œë¼ìš°ì €ì—ì„œ ë¬´ì‹œí•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ì…ë‹ˆë‹¤.

## React 17 Root ì‚¬ìš©

React 17ì€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ documentê°€ ì•„ë‹Œ React root ì»¨í…Œì´ë„ˆì— ì—°ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.

```javascript
// React 16 ì´í•˜
document.addEventListener('click', reactEventHandler);

// React 17+
const rootNode = document.getElementById('root');
rootNode.addEventListener('click', reactEventHandler);
```

ì´ ë³€ê²½ì´ í•´ê²°í•œ ë¬¸ì œë“¤.
1. í•œ í˜ì´ì§€ì—ì„œ ì—¬ëŸ¬ React ë²„ì „ì„ ì‹¤í–‰í•  ë•Œ ë°œìƒí•˜ë˜ ì´ë²¤íŠ¸ ì¶©ëŒì´ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤.
2. jQueryë‚˜ ë°”ë‹ë¼ JavaScriptì™€ ê°™ì€ ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ì˜ í†µí•© ë¬¸ì œê°€ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤.
3. stopPropagation()ì˜ ë¬¸ì œê°€ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.
	- stopPropagationì´ docuemntì— ë„ë‹¬í•˜ì—¬ ì‹¤í–‰ëœë‹¤ë©´ JSì´ë²¤íŠ¸ê°€ ì´ë¯¸ ë™ì‘í•˜ê³  ìˆê²Œ ë˜ëŠ” ê²½ìš°ê°€ ìƒê¸°ê¸° ë•Œë¬¸ì— ë¬¸ì œ.
4. , ë ˆê±°ì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ Reactë¥¼ ì ì§„ì ìœ¼ë¡œ ë„ì…í•˜ê¸°ê°€ í›¨ì”¬ ì‰¬ì›Œì¡ŒìŠµë‹ˆë‹¤.


## ì´ë²¤íŠ¸ ë²„ë¸”ë§ê³¼ ìº¡ì²˜ë§ì˜ ì‹¤ì œ ë™ì‘

Reactì˜ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì€ ë„¤ì´í‹°ë¸Œ DOMì˜ ì´ë²¤íŠ¸ ì „íŒŒ ëª¨ë¸ì„ ë”°ë¥´ë©´ì„œë„ ìì²´ì ì¸ í•©ì„± ë ˆì´ì–´ë¥¼ í†µí•´ ì²˜ë¦¬ë©ë‹ˆë‹¤. ì´ë²¤íŠ¸ëŠ” ìº¡ì²˜ ë‹¨ê³„, íƒ€ê²Ÿ ë‹¨ê³„, ë²„ë¸”ë§ ë‹¨ê³„ë¥¼ ê±°ì¹˜ë©°, ReactëŠ” ì´ë¥¼ onClickCaptureì™€ onClickìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì²˜ë¦¬í•©ë‹ˆë‹¤.

```jsx
function EventPropagationDemo() {
  const handleParentCapture = () => {
    console.log('ë¶€ëª¨ ìº¡ì²˜ (ì²« ë²ˆì§¸ ì‹¤í–‰)');
  };

  const handleChildClick = () => {
    console.log('ìì‹ í´ë¦­ (ë‘ ë²ˆì§¸ ì‹¤í–‰)');
  };

  const handleParentBubble = () => {
    console.log('ë¶€ëª¨ ë²„ë¸” (ì„¸ ë²ˆì§¸ ì‹¤í–‰)');
  };

  return (
    <div 
      onClickCapture={handleParentCapture}
      onClick={handleParentBubble}
    >
      <button onClick={handleChildClick}>
        í´ë¦­í•˜ì„¸ìš”
      </button>
    </div>
  );
}
```

stopPropagation()ì€ Reactì˜ í•©ì„± ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ ë‚´ì—ì„œ ì‘ë™í•˜ë©°, ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ë¡œ ì „íŒŒë˜ëŠ” ê²ƒì„ ë§‰ìŠµë‹ˆë‹¤, ëª¨ë‹¬ì´ë‚˜ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ êµ¬í˜„ ì‹œ íŠ¹íˆ ìœ ìš©í•©ë‹ˆë‹¤:

```jsx
function Modal({ isOpen, onClose, children }) {
  const handleOverlayClick = (event) => {
    // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œì—ë§Œ ë‹«ê¸°
    if (event.target === event.currentTarget) {
      onClose();
    }
  };

  const handleContentClick = (event) => {
    // ì»¨í…ì¸  í´ë¦­ ì‹œ ëª¨ë‹¬ì´ ë‹«íˆì§€ ì•Šë„ë¡ ë°©ì§€
    event.stopPropagation();
  };

  if (!isOpen) return null;

  return (
    <div className="modal-overlay" onClick={handleOverlayClick}>
      <div className="modal-content" onClick={handleContentClick}>
        {children}
      </div>
    </div>
  );
}
```

ì¤‘ìš”í•œ ì ì€ **ë„¤ì´í‹°ë¸Œ ì´ë²¤íŠ¸ê°€ Reactì˜ í•©ì„± ì´ë²¤íŠ¸ë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒ**ì…ë‹ˆë‹¤. ì‹¤í–‰ ìˆœì„œëŠ” ë„¤ì´í‹°ë¸Œ ìº¡ì²˜ â†’ ë„¤ì´í‹°ë¸Œ íƒ€ê²Ÿ â†’ ë„¤ì´í‹°ë¸Œ ë²„ë¸”ë§ â†’ React í•©ì„± ì´ë²¤íŠ¸ ì²˜ë¦¬ ìˆœì…ë‹ˆë‹¤.

## ì´ë²¤íŠ¸ì™€ Fiver Treeì˜ ì—°ê´€ ê´€ê³„

Reactì˜ ë Œë”ë§ ë‹¨ê³„ì™€ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì€ Fiber íŠ¸ë¦¬ë¥¼ ê³µìœ í•©ë‹ˆë‹¤:

```javascript
// Fiber ë…¸ë“œ êµ¬ì¡° (ê°„ì†Œí™”)
class FiberNode {
  constructor() {
    this.type = 'button';           // ì»´í¬ë„ŒíŠ¸ íƒ€ì…
    this.props = { onClick: ... };  // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í¬í•¨
    this.return = parentFiber;      // ë¶€ëª¨ Fiber
    this.child = childFiber;        // ì²« ìì‹
    this.sibling = nextSibling;     // í˜•ì œ
    this.stateNode = domElement;    // ì‹¤ì œ DOM ì°¸ì¡°
  }
}
```

### ë Œë”ë§ê³¼ ì´ë²¤íŠ¸ì˜ ì—°ê²°ì 
Render Phase: Fiber íŠ¸ë¦¬ êµ¬ì„±
Commit Phase: DOM ì—…ë°ì´íŠ¸ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡

```jsx
function CompleteExample() {
  const [count, setCount] = useState(0);
  
  return (
    <div onClick={() => console.log('Div clicked')}>
      <span>Count: {count}</span>
      <button onClick={() => setCount(count + 1)}>
        Increment
      </button>
    </div>
  );
}


```

**React ë‚´ë¶€ ì²˜ë¦¬ ê³¼ì •:**
1. Render Phase (Top-Down)
  - ìƒˆë¡œìš´ Fiber íŠ¸ë¦¬ ìƒì„±
  - props.onClick í™•ì¸

 1. Commit Phase(Bottom-Up) - 3ë‹¨ê³„:
	1. Before Mutation: ìŠ¤ëƒ…ìƒ· ì €ì¥
	2. Mutation: DOM ì—…ë°ì´íŠ¸
	3. Layout: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
       - rootì— í•„ìš”í•œ ì´ë²¤íŠ¸ íƒ€ì… ë“±ë¡
       - Fiber ë…¸ë“œì— ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë§¤í•‘

### Complete Workì™€ ì´ë²¤íŠ¸ ì „íŒŒ

Reactì˜ Complete WorkëŠ” ë Œë”ë§ ì¤‘ **bottom-upìœ¼ë¡œ ì§„í–‰**ë˜ëŠ”ë°, ì´ëŠ” ì´ë²¤íŠ¸ ë²„ë¸”ë§ê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤:

```jsx
function ComprehensiveDemo() {
  const [phase, setPhase] = useState('');
  
  // ëª¨ë“  ë‹¨ê³„ë¥¼ ì¶”ì 
  const trackEvent = (name, e) => {
    console.log(`${name} - isPropagationStopped: ${e.isPropagationStopped?.()}`);
    setPhase(name);
  };
  
  return (
    <div 
      onClickCapture={(e) => trackEvent('1. Div Capture', e)}
      onClick={(e) => trackEvent('4. Div Bubble', e)}
    >
      <div 
        onClickCapture={(e) => trackEvent('2. Inner Div Capture', e)}
        onClick={(e) => trackEvent('3. Inner Div Bubble', e)}
      >
        <button 
          onClick={(e) => {
            console.log('=== ë²„íŠ¼ í´ë¦­ ì‹œì‘ ===');
            console.log('ë„¤ì´í‹°ë¸Œ íƒ€ê²Ÿ:', e.nativeEvent.target);
            console.log('React íƒ€ê²Ÿ:', e.target);
            
            // Fiber íŠ¸ë¦¬ ì •ë³´ (React DevToolsì—ì„œ í™•ì¸ ê°€ëŠ¥)
            console.log('í˜„ì¬ Fiber:', e._targetInst);
            
            // stopPropagation í…ŒìŠ¤íŠ¸
            // e.stopPropagation();
          }}
        >
          í´ë¦­í•˜ì—¬ ì „íŒŒ í™•ì¸
        </button>
      </div>
      
      <div>í˜„ì¬ ë‹¨ê³„: {phase}</div>
    </div>
  );
}
```
í´ë¦­ ì‹œ ìˆœì„œ:
 1. ë„¤ì´í‹°ë¸Œ ì´ë²¤íŠ¸ ë°œìƒ (button)
 2. ë²„ë¸”ë§ìœ¼ë¡œ root ë„ë‹¬
 3. Reactê°€ ê°€ë¡œì±„ì„œ Fiber íŠ¸ë¦¬ íƒìƒ‰
 4. ìº¡ì²˜ ì‹œë®¬ë ˆì´ì…˜ (ìœ„ â†’ ì•„ë˜)
 5. íƒ€ê²Ÿ ì‹¤í–‰
 6. ë²„ë¸”ë§ ì‹œë®¬ë ˆì´ì…˜ (ì•„ë˜ â†’ ìœ„)

## ì„±ëŠ¥ìƒ ì´ì ê³¼ ì‹¤ì œ ì¸¡ì • ê²°ê³¼

Reactì˜ ì´ë²¤íŠ¸ ìœ„ì„ì´ ì œê³µí•˜ëŠ” ì„±ëŠ¥ ì´ì ì€ ì´ë¡ ì ìœ¼ë¡œëŠ” ëª…í™•í•˜ì§€ë§Œ, ì‹¤ì œ ì¸¡ì • ê²°ê³¼ëŠ” ë” ë¯¸ë¬˜í•œ ê·¸ë¦¼ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. **3000ê°œ ì´ìƒì˜ ìš”ì†Œë¥¼ í…ŒìŠ¤íŠ¸í•œ ê²°ê³¼, Reactì˜ ë‚´ë¶€ ìµœì í™”ë¡œ ì¸í•´ ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ìœ„ì„ì„ êµ¬í˜„í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ê²ƒì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤**.

```jsx
// ì„±ëŠ¥ í…ŒìŠ¤íŠ¸: 3000ê°œ ë²„íŠ¼ì— ëŒ€í•œ ì§ì ‘ í•¸ë“¤ëŸ¬
function DirectHandlers() {
  const [selectedItems, setSelectedItems] = useState(new Set());
  
  return (
    <div>
      {Array.from({length: 3000}, (_, i) => (
        <button 
          key={i}
          onClick={() => setSelectedItems(prev => new Set([...prev, i]))}
          style={{
            backgroundColor: selectedItems.has(i) ? 'blue' : 'gray'
          }}
        >
          ë²„íŠ¼ {i}
        </button>
      ))}
    </div>
  );
}
```

ì„±ëŠ¥ ì¸¡ì • ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì—ì„œëŠ” Reactê°€ ì´ë¯¸ ë‚´ë¶€ì ìœ¼ë¡œ ìœ„ì„ì„ ì²˜ë¦¬í•˜ë¯€ë¡œ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ì—†ì—ˆìŠµë‹ˆë‹¤. ì´ˆê¸° ë Œë”ë§ ì‹œê°„ì€ 3000ê°œ ìš”ì†Œ ê¸°ì¤€ 50ms ë¯¸ë§Œì˜ ì°¨ì´ë¡œ ë¯¸ë¯¸í–ˆìŠµë‹ˆë‹¤. ì´ë²¤íŠ¸ ì²˜ë¦¬ ì†ë„ëŠ” DOM íƒìƒ‰ì´ ì ì€ ì§ì ‘ í•¸ë“¤ëŸ¬ê°€ ì•½ê°„ ë” ë¹¨ëì§€ë§Œ ì‹¤ì‚¬ìš©ì—ì„œëŠ” ì²´ê°ë˜ì§€ ì•ŠëŠ” ìˆ˜ì¤€ì´ì—ˆìŠµë‹ˆë‹¤.

**Reactì˜ ì´ë²¤íŠ¸ ìœ„ì„ì´ ì œê³µí•˜ëŠ” ì‹¤ì§ˆì  ì´ì **ì€ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±(ì´ë²¤íŠ¸ íƒ€ì…ë‹¹ ë‹¨ì¼ ë¦¬ìŠ¤ë„ˆ), ë™ì  ì»¨í…ì¸  ì²˜ë¦¬(ìƒˆë¡œ ì¶”ê°€ëœ ìš”ì†Œ ìë™ ì²˜ë¦¬), ì¼ê´€ëœ ì´ë²¤íŠ¸ ë™ì‘(í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì € í˜¸í™˜ì„±), ê·¸ë¦¬ê³  ì»´í¬ë„ŒíŠ¸ ê²©ë¦¬(ì´ë²¤íŠ¸ ì²˜ë¦¬ê°€ ì»´í¬ë„ŒíŠ¸ ê²½ê³„ ë‚´ì— ìº¡ìŠí™”)ì…ë‹ˆë‹¤.

```jsx
// ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìµœì í™” íŒ¨í„´
import { useCallback, memo } from 'react';

const OptimizedButton = memo(({ onClick, children }) => {
  return <button onClick={onClick}>{children}</button>;
});

function ParentComponent() {
  const [count, setCount] = useState(0);
  
  // ë©”ëª¨ì´ì œì´ì…˜ëœ í•¸ë“¤ëŸ¬ë¡œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
  const handleClick = useCallback(() => {
    setCount(c => c + 1);
  }, []);

  return (
    <div>
      <p>ì¹´ìš´íŠ¸: {count}</p>
      <OptimizedButton onClick={handleClick}>
        ì¦ê°€
      </OptimizedButton>
    </div>
  );
}
```

## ì´ë²¤íŠ¸ í’€ë§ê³¼ ìµœì‹  ë²„ì „ì˜ ë³€í™”

### ğŸŠ ì´ë²¤íŠ¸ í’€ë§ì´ë€?

**ì´ë²¤íŠ¸ í’€ë§**ì€ React 16ê¹Œì§€ ì‚¬ìš©ëœ ë©”ëª¨ë¦¬ ìµœì í™” ê¸°ë²•ìœ¼ë¡œ, SyntheticEvent ê°ì²´ë¥¼ ì¬ì‚¬ìš©í•˜ì—¬ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ë¶€ë‹´ì„ ì¤„ì´ëŠ” ë°©ì‹ì´ì—ˆìŠµë‹ˆë‹¤.

```jsx
// React 16 ë‚´ë¶€ êµ¬í˜„ (ê°„ì†Œí™”)
class SyntheticEventPool {
    constructor() {
        this.pool = [];
        this.maxPoolSize = 10;
    }
    
    getPooledEvent(nativeEvent) {
        // í’€ì—ì„œ ì´ë²¤íŠ¸ ê°ì²´ êº¼ë‚´ê¸°
        if (this.pool.length > 0) {
            const event = this.pool.pop();
            event.nativeEvent = nativeEvent;
            event.target = nativeEvent.target;
            // ... ë‹¤ë¥¸ ì†ì„±ë“¤ ì„¤ì •
            return event;
        }
        // í’€ì´ ë¹„ì–´ìˆìœ¼ë©´ ìƒˆë¡œ ìƒì„±
        return new SyntheticEvent(nativeEvent);
    }
    
    releaseEvent(event) {
        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì‹¤í–‰ í›„ ì¦‰ì‹œ í˜¸ì¶œë¨
        event.target = null;
        event.nativeEvent = null;
        event.currentTarget = null;
        // ëª¨ë“  ì†ì„±ì„ nullë¡œ ì´ˆê¸°í™”!
        
        if (this.pool.length < this.maxPoolSize) {
            this.pool.push(event);  // í’€ì— ë°˜í™˜
        }
    }
}
```

### ì´ë²¤íŠ¸ í’€ë§ì´ ì¼ìœ¼í‚¨ ë¬¸ì œë“¤

#### ëŒ€í‘œì ì¸ ë¬¸ì œ : ë¹„ë™ê¸° ì‘ì—…ì—ì„œ ì´ë²¤íŠ¸ ì ‘ê·¼ ë¶ˆê°€

```javascript
// React 16ì—ì„œ ìì£¼ ë°œìƒí•œ ë²„ê·¸
function BadComponent() {
    const handleClick = (e) => {
        console.log(e.target);  // <button> âœ… ì •ìƒ ë™ì‘
        
        setTimeout(() => {
            console.log(e.target);  // null âŒ ì—ëŸ¬!
            // Warning: This synthetic event is reused for performance reasons
        }, 100);
    };
    
    return <button onClick={handleClick}>í´ë¦­</button>;
}

// ì™œ nullì´ ë˜ë‚˜?
// 1. í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ
// 2. handleClick ì‹¤í–‰
// 3. í•¨ìˆ˜ ì‹¤í–‰ ëë‚˜ë©´ Reactê°€ ì¦‰ì‹œ ì´ë²¤íŠ¸ ê°ì²´ ì´ˆê¸°í™”
// 4. 100ms í›„ setTimeout ì‹¤í–‰ë  ë•ŒëŠ” ì´ë¯¸ ì´ˆê¸°í™”ë¨
```

React 17ì—ì„œ ì´ë²¤íŠ¸ í’€ë§ì´ ì œê±°ëœ ì´ìœ ëŠ” ëª…í™•í•©ë‹ˆë‹¤. í˜„ëŒ€ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ê°ì²´ ìƒì„± ë¹„ìš©ì´ í¬ê²Œ ì¤„ì–´ë“¤ì–´ ì„±ëŠ¥ ì´ì ì´ ì‚¬ë¼ì¡Œê³ , event.persist() ìš”êµ¬ì‚¬í•­ì´ ê°œë°œìë“¤ì—ê²Œ í˜¼ë€ê³¼ ë²„ê·¸ì˜ ì›ì¸ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. **Facebookì˜ ë‚´ë¶€ ë°ì´í„°ì— ë”°ë¥´ë©´ 100,000ê°œ ì´ìƒì˜ ì»´í¬ë„ŒíŠ¸ ì¤‘ ë‹¨ 20ê°œ ë¯¸ë§Œë§Œì´ ì´ ë³€ê²½ìœ¼ë¡œ ì¸í•œ ìˆ˜ì •ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤**. ì´ë²¤íŠ¸ í’€ë§ ì œê±°ë¡œ ë²ˆë“¤ í¬ê¸°ëŠ” ì•½ 0.7% ê°ì†Œí–ˆìœ¼ë©°, ëŸ°íƒ€ì„ ì„±ëŠ¥ ì €í•˜ëŠ” ì¸¡ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

React 18ê³¼ 19ëŠ” ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì´ ë”ìš± ë°œì „í•˜ì˜€ìŠµë‹ˆë‹¤.
React 18ì€ ìë™ ë°°ì¹­ì„ ëª¨ë“  ì´ë²¤íŠ¸ë¡œ í™•ì¥í•˜ì—¬ setTimeout, Promise, ë„¤ì´í‹°ë¸Œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ì—ì„œë„ ìƒíƒœ ì—…ë°ì´íŠ¸ê°€ ìë™ìœ¼ë¡œ ë°°ì¹­ë©ë‹ˆë‹¤. ë˜í•œ ì´ë²¤íŠ¸ ìš°ì„ ìˆœìœ„ ì‹œìŠ¤í…œì„ ë„ì…í•˜ì—¬ ì‚¬ìš©ì ì…ë ¥(í´ë¦­, í‚¤ë³´ë“œ)ì€ ë†’ì€ ìš°ì„ ìˆœìœ„ë¡œ, ìŠ¤í¬ë¡¤ì´ë‚˜ ë§ˆìš°ìŠ¤ ì´ë™ì€ ë‚®ì€ ìš°ì„ ìˆœìœ„ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
ë°°ì¹­ ? : ì—¬ëŸ¬ ê°œì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ í•˜ë‚˜ë¡œ ë¬¶ì–´ì„œ ë‹¨ í•œ ë²ˆë§Œ ë¦¬ë Œë”ë§í•˜ëŠ” ìµœì í™” ê¸°ë²•

```jsx
// React 18: ìë™ ë°°ì¹­
function React18Features() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('');

  const handleClick = () => {
    // ì´ ì—…ë°ì´íŠ¸ë“¤ì´ ìë™ìœ¼ë¡œ ë°°ì¹­ë¨
    setCount(c => c + 1);
    setName('ì—…ë°ì´íŠ¸ë¨');
    // ë‹¨ í•œ ë²ˆì˜ ë¦¬ë Œë”ë§ë§Œ ë°œìƒ
  };

  // setTimeout ë‚´ì—ì„œë„ ë°°ì¹­ ì ìš©
  const handleTimeout = () => {
    setTimeout(() => {
      setCount(c => c + 1);
      setName('ì§€ì—° ì—…ë°ì´íŠ¸');
      // React 17: ë‘ ë²ˆ ë¦¬ë Œë”ë§
      // React 18: í•œ ë²ˆë§Œ ë¦¬ë Œë”ë§
    }, 1000);
  };

  return (
    <div>
      <button onClick={handleClick}>ë°°ì¹­ëœ ì—…ë°ì´íŠ¸</button>
      <button onClick={handleTimeout}>íƒ€ì„ì•„ì›ƒ ë°°ì¹­</button>
    </div>
  );
}
```

## ê²°ë¡ 



 ì „ì²´ í”Œë¡œìš°: 
1. ì‚¬ìš©ì í´ë¦­ 
2. ë„¤ì´í‹°ë¸Œ ì´ë²¤íŠ¸ ìº¡ì²˜/ë²„ë¸”ë§ 
3. React rootì—ì„œ ì´ë²¤íŠ¸ ê°€ë¡œì±” 
   ```js
// ì´ë²¤íŠ¸ ì „íŒŒ ê³¼ì •
function EventPropagation() {
    // 1. ìº¡ì²˜ ë‹¨ê³„ (Capture Phase) - ìœ„ì—ì„œ ì•„ë˜ë¡œ
    Window â†’ Document â†’ html â†’ body â†’ div#root â†’ div.parent â†’ button
    
    // 2. íƒ€ê²Ÿ ë‹¨ê³„ (Target Phase)
    button (ì‹¤ì œ í´ë¦­ëœ ìš”ì†Œ)
    
    // 3. ë²„ë¸”ë§ ë‹¨ê³„ (Bubbling Phase) - ì•„ë˜ì—ì„œ ìœ„ë¡œ
    button â†’ div.parent â†’ div#root â†’ body â†’ html â†’ Document â†’ Window
}
```

1. Fiber íŠ¸ë¦¬ì—ì„œ íƒ€ê²Ÿ ì°¾ê¸° (ë²„ë¸”ë§ê³¼ ìœ ì‚¬í•œ íƒìƒ‰) 
2. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì‹¤í–‰ â†’ setState 
3. ì¬ì¡°ì • ì‹œì‘ 
4. BeginWork (ìº¡ì²˜ì™€ ìœ ì‚¬í•œ Top-Down) 
5. CompleteWork (ë²„ë¸”ë§ê³¼ ìœ ì‚¬í•œ Bottom-Up) 
6. Commit Phase (DOM ì—…ë°ì´íŠ¸) 
7. ë¸Œë¼ìš°ì € í˜ì¸íŒ… 
8. ì‚¬ìš©ìê°€ ë³€ê²½ì‚¬í•­ í™•ì¸

### ì¶”ê°€ : ì—ëŸ¬ ë°”ìš´ë”ë¦¬ì— onClick ì´ë²¤íŠ¸ê°€ ê±¸ë¦¬ì§€ ì•ŠëŠ” ì´ìœ .

**ì´ìœ **  

1. ë¦¬ì•¡íŠ¸ëŠ” rootì—ì„œ ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ í•¸ë“¤ë§í•©ë‹ˆë‹¤.
2. ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ë¥¼ ë”°ë¼ ë‚´ë ¤ê°€ë©° ì´ë²¤íŠ¸ë¥¼ ìœ„ì„ì‹œí‚µë‹ˆë‹¤.

**[React Error Boundaryê°€ ë™ì‘í•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ”?](https://legacy.reactjs.org/blog/2020/08/10/react-v17-rc.html#changes-to-event-delegation)**  

- ì‹¤ì œ ì—ëŸ¬ ë°œìƒì§€ëŠ” rootì´ê¸° ë•Œë¬¸ì— ì—ëŸ¬ ë°”ìš´ë”ë¦¬ì—ì„œ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**[ì™œ ì´ë ‡ê²Œ ì„¤ê³„í–ˆì§€?](https://github.com/facebook/react/issues/11409#issuecomment-340859253)**  

- í—¨ë“¤ëŸ¬ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì›ë³¸ ì»´í¬ë„ŒíŠ¸ë¥¼ ì•Œ ìˆ˜ê°€ ì—†ë‹¤.
- ë¹„ë™ê¸° ì˜¤ë¥˜ë¥¼ Reactì—ì„œ í¬ì°©í•  ë°©ë²•ì´ ì—†ë‹¤.

ì¶œì²˜ :Â [https://onlydev.tistory.com/204](https://onlydev.tistory.com/204)
