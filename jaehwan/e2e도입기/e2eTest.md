입사 후 첫 프로젝트를 진행하면서 팀 내에 QA 담당자가 따로 없어 개발자와 비개발자가 함께 테스트를 진행해야 했습니다. QA 과정에서 같은 행동을 여러 번 반복하는 작업들이 많았고, 이러한 리소스를 줄이고자 E2E 테스트를 도입하기로 결정했습니다.

### E2E 테스트란?

E2E 테스트는 **End To End 테스트**의 약자로, 애플리케이션의 흐름을 처음부터 끝까지 테스트하는 것을 의미합니다.

유닛 테스트나 통합 테스트는 모듈의 무결성을 증명하는 데 적합하지만, QA를 대체하기에는 부족했습니다. 그래서 우리는 E2E 테스트를 선택했습니다.

E2E 테스트는 실제 사용자의 시나리오를 테스트함으로써 애플리케이션의 동작을 검증하고, 애플리케이션의 무결성을 증명합니다.

<br>

### E2E 테스트를 선택한 이유

처음부터 E2E 테스트를 도입하려 한 것은 아닙니다. 먼저 no-code 테스트 툴부터 검토했습니다.

Katalon Studio, Reflect, BrowserStack 등 6가지 이상의 no-code 툴을 살펴봤습니다. 이들의 장점은 코드 없이 테스트가 가능하며, 웹, 앱, 심지어 리눅스 테스트까지 할 수 있다는 것이었습니다.

하지만 도입하지 않은 이유도 분명했습니다:

1. 대부분 최소 월 200달러 이상의 높은 가격
2. 웹, 앱, 리눅스 테스트가 가능한 만큼 크고 무거운 프로그램
3. 기능이 많아 높은 학습 곡선

웹 테스트만 하는 우리 입장에서는 가격이 부담스러웠고, 제가 없어도 다른 팀원들이 테스트를 할 수 있어야 했기 때문에 높은 러닝커브도 문제였습니다.

<br>

그나마 웹 테스트만 가능하고 가벼우며 러닝커브가 낮은 [bugbug](https://bugbug.io/)라는 no-code 툴이 후보군에 올랐습니다.

bugbug와 함께 E2E테스트 라이브러리 두가지가 후보에 올랐습니다.

**최종 후보군**

- bugbug
- cypress
- playwright

bugbut : 월 99달러의 유료 버전이 필요했고, 계속 발전하는 AI를 활용하지 못한다는 점에서 아쉬

cypress : 병렬 테스트가 유료이며 직접 브라우저를 조작하기 때문에 많은 테스트를 처리할때 속도가 느려지고 코드 제너레이터의 기능이 적습니다.

playwright : 유료버전이 존재하지 않고 병렬테스트가 가능하며 headless 브라우저로 조작하여 많은 테스트를 빠르게 처리하고 코드 제너레이터의 기능이 최근에 추가되어 편리합니다.

최종적으로 playwright를 사용하게 되었습니다.

<br>

### **E2E 도입 전략**

<br>

**기획서 기반 테스트 시나리오 작성 - 카카오 테크**
    
  기획서 기반으로 작성한다면 새로운 피처나 기능 수정이 필요할 때 기획서가 변경될 것이고 똑같이 테스트 시나리오를 변경하는 전략입니다.
    
  **방법**
  
  - 기획서 업데이트 ⇒ 테스트 코드 업데이트
  
  - 장점 : 테스트 코드 관리가 쉬워집니다. 꼼꼼한 테스트 코드 작성이 가능합니다.
  
  - 단점 : 기획서의 양이 만만치 않습니다. 재사용을 염두에 둘 수 없습니다.

    <br>

**기획서 기반 페이지 단위 테스트 시나리오 작성 - 카카오 엔터테이먼트**
    
  E2E는 테스트 단위가 유저 시나리오입니다. 각 시나리오는 독립적으로 구성해야 합니다.(시나리오 내부에서 독립성을 띄우기는 어렵습니다.)
  
  **방법**
  
  - 모든 비즈니스 로직에 대한 테스트 항목 리스트 작성 후 테스트 항목을 페이지 단위로 묶습니다.
  
  - 페이지당 파일을 하나로 구현하고 테스트합니다.
  
  - 장점 :  재사용이 가능할 수 있습니다.
  
  - 단점 : 유저 시나리오 특성상 여러 페이지에서 움직입니다. 유저 시나리오가 아닌 페이지 별 테스트라는 점에서 유저 테스트보다 개발 테스트에 가깝습니다.
    
<br>

유저 시나리오 대로 작성을 배제한 이유

- 테스트 코드 관리가 어렵다는 결론이었습니다. 유저 시나리오대로 그냥 클릭만 하며 페이지를 돌아다니는 것이 아닌 변경사항에 대해 무결성을 검증해야합니다.
- 간단하게 유저 시나리오대로 작성한다는 개념은 오히려 복잡성과 재사용성을 방해할 수 있습니다.

<br>

### 도입 결과

130개 이상의 테스트를 만들었고  테스트 인원이 50%감소하게 되었습니다.

<img width="500" alt="e2e3" src="https://github.com/user-attachments/assets/68d143be-ddce-4c7d-8af8-92f3b328ebb0" >

<img width="500" alt="e2e3" src="https://github.com/user-attachments/assets/3fd0e6be-e162-47d3-8c9e-ae794e13c7e8">


**새로운 문제**

신뢰성이 과연 높은가?

- 테스트 케이스와 별도로 정책에 대한 테스트를 문서화하지 않고 E2E테스트를 제작하여 테스트가 100개가 넘어가는 순간 얼마나 검증을 하고 있는가에 대한 신뢰도가 떨어졌습니다. 테스트 케이스 문서에 의존하는 형태로 테스트를 제작하도록 하여 신뢰도를 증가시켜야 할 필요를 느꼈습니다.

동일한 테스트 환경 구축

- local, develop, production 3가지 환경에서 동일한 테스트 환경을 구축해야 테스트 신뢰도가 높아질 것입니다. 현재는 모든 환경에서 같은 데이터를 가진 아이디로 로그인하여 테스트를 진행하였습니다. 하지만 한번 클릭하면 disable되는 버튼이나 후기 작성을 하면 두번 작성이 안되는 문제로 인해 백엔드 개발자에게 계속 요청이 필요한 상황이 발생했습니다. 동일한 환경에 데이터를 초기로 되돌릴 수 있는 방법을 찾는 다면 지속적인 요청을 할 필요가 없어질 듯 합니다.

**E2E를 실제 도입하여 해결된 부분**

- QA 효율성 : 이전에 4~5명에서 하던 테스트를 두명에서 하게되어 효율이 좋아진 것은 확실하게 느껴집니다. 그리고 테스트를 제작하며 개발에서 놓쳤던 부분들을 한번 더 확인하게 되며 자잘한 부분에서 꽤나 많은 부족한 개발 요소를 발견하게 되었습니다.
- 재활용성 : 기획서 기반으로 테스트를 작성하되 페이지 기반으로 정리하여 재활용성은 높습니다.
- 여러 서버 테스트 : 로컬,개발,운영 서버를 매번 QA하지않고 테스트를 재활용하여 QA시간이 대폭 줄었습니다.

<br>
<br>
<br>

참고 : 

- https://f-lab.kr/insight/frontend-testing-strategies
    - 전체 흐름 테스트
    - 사용자 시나리오를 모방
    - 전체 시스템이 예상대로 동작하는지를 검증
    - 실제 사용환경 중요.
    - 사용자의 인터페이스와 관련된 기능을 중점적으로 테스트하기 때문, 사용자 경험을 보장해줌.
- https://velog.io/@sdong001/실용적인-리액트-테스트-전략
    - 기획요소에 따라 테스트가 수정될 수 있으므로 사용자 시나리오가 복잡하다면 비용이 클 수 있다.
    - 확정된 시나리오일수록 구체적으로 작성될 필요가있다.
- https://developer-bandi.github.io/post/frontend-testing/
    - QA팀이 존재하는 경우 QA팀과 논의하여 프론트팀이 QA팀을 보조하는 형식으로 E2E테스트를 진행하는것이 좋다고 생각

https://fe-developers.kakaoent.com/2023/230209-e2e/

https://medium.com/delivus/e2e-테스트-구축기-used-aws-step-functions-2fccb930218c

https://shorttrack.tistory.com/7

https://junheedot.tistory.com/entry/프론트엔드-테스트-코드-시작하기-개념편
