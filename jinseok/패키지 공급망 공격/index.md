# 패키지 공급망 공격

## 패키지 공급망 공격이란?

- 애플리케이션이 의존하는 오픈 소스 패키지나 라이브러리를 악용하여 악성 코드를 심는 공격
- 오픈 소스 패키지에 공격자가 악성 코드를 추가하면, 해당 패키지를 사용하는 모든 애플리케이션에 악성 코드가 전파될 수 있음
- 개발자가 직접 작성한 코드가 아니기 때문에 눈치채기 어렵고, 한 번 성공하면 **광범위한 파급 효과**를 낳게됨
- **오픈 소스 패키지 메인테이너**가 사이버 공격의 최전선이 되고 있으며, 해당 계정이 탈취당하면 순식간에 수백만 개발자와 수많은 서비스에 영향을 미치기도 함

## 최근 발생한 주요 공격 사례

| **패키지(사례)**              | **공격 목표(주요 대상)**                  | **공격 방식(요약)**                                                                                                                  |
| ----------------------------- | ----------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| **chalk / debug 등**          | **최종 사용자(브라우저에 노출되는 번들)** | 유지보수자 계정 탈취 → 악성 버전(브라우저에서 실행 시 지갑 주소 변조 / 크립토 스틸러 등) 배포. 최종 번들에 포함되면 사용자 피해 가능 |
| **eslint-config-prettier 등** | **개발자/개발자 PC(Windows 환경)**        | 악성 postinstall / native DLL 실행 등으로 개발자 로컬에서 코드 실행 → 로컬 자격증명·파일 탈취                                        |
| **Nx (s1ngularity)**          | **개발자·CI 환경(개발자 토큰)**           | GitHub Actions 토큰 탈취 또는 postinstall 훅으로 로컬/CI 자격증명 수집 → GitHub에 유출/업로드. 주로 개발자·CI 자격증명 탈취 목적     |

### 2025년 9월: chalk·debug 등 인기 패키지 대규모 공격

#### 개요

- **Qix**(‘debug’ 패키지의 만든이)의 npm 계정이 **피싱 공격**으로 탈취
- **chalk**, **debug**를 비롯한 총 18개의 인기 패키지에 악성 코드를 넣어 새로운 버전을 npm에 게시
- 이들 패키지는 주당 **20억 건 이상의 다운로드**를 합산할 만큼 널리 쓰이는 기본 라이브러리

#### 공격 방법

1. npm 지원팀을 사칭한 이메일을 통해 메인테이너의 로그인 정보와 OTP 코드를 가로챔
   - npmjs.help 도메인으로 가짜 2FA 재설정을 유도함
2. 설치된 악성 버전들은 주로 **웹 브라우저 환경에서 실행될 때 동작**하도록 설계
   - 사용자의 브라우저에서 **네트워크 요청과 암호화폐 지갑 API(window.ethereum 등)를 후킹**
   - **트랜잭션에 사용되는 지갑 주소나 승인 대상**을 공격자 지갑으로 변경
   - 사용자가 코인 전송이나 결제를 할 때 **눈치채지 못한 채 공격자에게 자금을 보내게 만듦**

![]('./chalk-ethereum-script.png)
_전체 스크립트: https://gist.github.com/sindresorhus/2b7466b1ec36376b8742dc711c24db20_

#### 결과

- 악성 버전들은 게시된 지 약 **2시간 만에** 커뮤니티에 의해 발견되어 이슈가 제기됨
  - 메인테이너도 즉각 대응하여 해당 버전들을 **삭제 및 정상 버전으로 교체**
  - npm 측에서도 바로 해당 계정을 차단
- **짧은 시간 내에**도 수많은 프로젝트가 악성 코드를 받아 빌드에 포함, 일부는 실제 사용자들에게까지 전파
  - 다행히도 **암호화폐 탈취라는 공격 목표**는 큰 피해를 발생시키지 못한 것으로 보고됨 ([$0 추정](https://x.com/vxunderground/status/1965125389245940171))
  - 다만 전 세계 개발자들과 기업들이 점검하고 대응하느라 치른 **간접 비용이 더 막대함**
    - 키 회수, 리빌드, 모니터링, 장애 대응 인건비 등
- 우리가 신뢰하던 유명 오픈 소스 프로젝트들도 **공급망 공격에 취약**할 수 있으며, 한 번 뚫리면 **수백만 사용자에게 영향**을 줄 수 있음

![]('./wiz-hijacked-npm-graph.png)
_Wiz 연구팀의 분석 자료: 좌측 그래프는 공격 대상이 된 인기 패키지들이 클라우드 환경에서 얼마나 널리 사용되고 있었는지 (99%의 환경에서 적어도 하나 사용), 우측은 짧은 배포 기간 동안 실제 악성 코드가 포함되어 배포된 비율 (10%의 환경에서 발견됨)을 나타냅니다. 불과 2시간 남짓 노출된 악성 패키지가 얼마나 빠르게 전파될 수 있는지 보여주는 사례입니다._

### 2025년 8월: nx

- Nx의 npm 게시 권한을 얻어(계정 탈취 또는 권한 남용 추정) **특정 버전**에 악성 스크립트를 심음
- 설치될 때 실행되는 postinstall 훅을 악용
  - **개발자의 PC나 CI 환경의 파일 시스템을 스캔**하여 **API 키, 토큰, 지갑 키** 등의 **민감 정보를 탈취**
  - 피해자들의 GitHub 계정에 **s1ngularity-repository**라는 새 레포지토리를 생성하고, 탈취한 정보를 암호화된 형태로 업로드
  - 최소 **1,400명 이상의 개발자**들이 이 악성 Nx를 설치하여 **자신들의 API 키나 가상자산 지갑 정보 등이 유출**되는 피해를 입은 것으로 보고됨
- **2025년 8월 26일** 문제가 된 버전이 npm에서 **신속히 삭제**되고, 약 한 시간 후 해당 npm 계정도 차단됨
  - 그러나 이미 악성 패키지를 설치한 개발자들의 비밀 키와 자격 증명은 유출
  - 개발자용 도구 자체가 오염되었을 때 발생할 수 있는 **최악의 시나리오**
  - 특히 Nx의 경우 개발자 PC에서 동작하는 도구이기에, **로컬 환경 보안**까지 위협받을 수 있다는 점에서 충격
  - IDE 확장이나 AI 코파일럿 도구 등이 백그라운드로 Nx를 가져다쓰는 경우에도 영향을 받았다는 보고
    - 간접적으로 의존하는 도구까지 포괄하여 공급망 공격의 영향 범위를 생각해야 함

### 2025년 7월: eslint-config-prettier

![]('./eslint-config-prettier-email.png)

- 메인테이너를 노린 피싱 캠페인
  - **npnjs.com**이라는 도메인을 등록해 놓고, npm에서 온 것처럼 보이는 메일을 보내 **로그인 정보를 탈취**
  - 여러 인기 패키지들의 관리 권한을 공격자가 획득
- eslint-config-prettier의 경우 수천만 주간 다운로드 수를 자랑
  - 악성 버전들은 **Windows 환경에서 실행되는 악성코드**를 포함
  - 도미노 효과로 인해 다른 패키지(is 패키지 등)의 유지보자 계정까지 추가로 피해를 입는 등 여파가 존재
- 문제를 인지한 즉시 npm 토큰을 리셋하고 npm 측과 협력하여 신속히 삭제 조치
- 메인테이너의 이메일 노출만으로도 공격자들의 표적이 될 수 있음
  - npm 계정 보안(이메일 보안, 2FA 등)의 중요성

### 그 외의 공급망 공격 사례

- **Event-Stream** 라이브러리에 의도된 백도어가 심겨 약 8백만 건의 피해를 낳은 사건
- **UA-Parser-JS**가 공격당해 암호화폐 채굴 및 정보탈취 악성코드를 배포한 사건
- **colors.js**와 **faker.js** 메인테이너가 스스로 코드를 망가뜨리는 사보타주를 일으켜 혼란을 준 사례
- 25년 9월 감행된 **“Shai Hulud”** 라는 **웜(worm)** 형태의 공격
  - Nx 사건의 배후로 추정되는 세력. 숨겨진 CI 워크플로우를 통해 백도어를 심으며 패키지 간에 퍼짐
  - 초기 악성코드가 단순하더라도 다른 패키지와 CI 시스템을 통해 횡적으로 확산될 수 있음을 보여줌

## 구조적 원인

### 오픈 소스 생태계의 광범위한 의존성

- 현대 웹 프로젝트들은 수백 개 이상의 npm 패키지를 의존
- Chalk, Debug 같은 작은 유틸리티부터 ESLint 설정, 빌드 툴까지 다양한 레벨의 패키지
  - 특히, 직접 의존성보다 트랜지티브 의존성으로 포함되는 경우가 다수 → 인지 어려움
- 이 중 하나만 문제가 생겨도 연쇄적으로 모든 상위 프로젝트에 영향

### 메인테이너의 개인 계정 보안 취약

- 많은 오픈 소스 프로젝트가 소수의 개인 유지보수자에게 의존
- npm 계정이나 GitHub 권한이 탈취되면 공격자는 합법적인 배포자로 위장 가능
- npm은 2FA를 인기 패키지에 의무화하는 등 보안조치를 하고 있지만, **사회공학적 기법**(피싱)에는 취약
  - chalk 사건과 ESLint 플러그인 사건 모두 교묘한 피싱 이메일 하나로 ‘트로이 목마’가 됨
  - “JS 생태계의 절반이 단일 개발자가 유지하는 한 줄짜리 유틸리티에 의존하고 있다는 것이 현실”
- npm은 최근에 들어 시그스토어(Sigstore) 기반의 **출처 증명 및 서명 기능**을 지원
- “코드 자체의 취약성”보다 **사람(계정)·프로세스(퍼블리시 워크플로우)의 취약성**이 더 자주 악용됨

### 배포 파이프라인의 신뢰 기반

- npm을 비롯한 패키지 레지스트리는 개발자의 신뢰를 바탕으로 운영
- 새로운 버전을 게시할 때 자동으로 코드 검토가 이루어지지 않으며, 악성 코드 유무를 일일이 검사하지 않음
- 공격자들은 악성 페이로드를 **철저히 난독화**하여 올리기 때문에, 게시 직후엔 **눈치채기 어려움** (예: chalk)
- 커뮤니티의 보안 연구자나 사용자들이 이상 징후를 발견하고 신고해야 드러나는 실정
- “신뢰하되 검증하지 않는” 구조적 한계

### 하이 리턴

- 인기 오픈 소스 하나만 뚫으면 다수 기업에 침투할 **백도어**를 심는 것이나 다름없음
  - chalk 사건에서 공격자는 수 시간 만에 **10%의 클라우드 환경**에 악성코드를 퍼뜨림
  - Nx 사건에서는 1천 명 넘는 개발자의 **API 키와 암호**를 탈취

### 모니터링 및 대응 체계의 한계

- 오픈소스 커뮤니티와 보안 업체들이 점점 더 빠르게 이상 징후를 탐지하지만, 여전히 새로운 공격 기법에 대한 선제적 차단은 어려운 상황
- 결국 대부분의 방어 조치는 사후 대응적일 수밖에 없으며, 공격자가 얼마나 신속히 탐지되느냐에 따라 피해 규모가 좌우됨

## 예방과 대응 전략

### 철저한 의존성 관리

- 신규 패키지 검증: 주간 다운로드 수, 최근 커밋·릴리즈 활동, 유지보수자 신뢰성 확인
- lockfile 고정: 새 패키지 외에는 버전이 바뀌지 않도록 관리
- 코드/설정 검토: dependencies에 낯선 패키지나 postinstall 스크립트가 추가되었는지 확인
- 업데이트/설치 시 changelog 확인: 주요 버전 변경 시 특히 검토
- CI/CD에서 자동 스캐닝: npm audit, Snyk, Dependabot, Socket.dev, Semgrep Supply Chain 등
- postinstall 로그 주시: 터미널에 예상치 못한 빌드/다운로드 메시지가 나오면 의심
- 보안 도구 활용: 정적/동적 애널리시스 도구나 악성 패키지 탐지 솔루션을 CI 파이프라인에 도입

### 보안 이슈/사고 소식을 접했을 때

- 영향 범위 확인: `npm ls`, `yarn why`, `pnpm ls`, lockfile 검색, SCA 도구 활용
  - 내가 직접 쓰지 않은 패키지도 어떤 경로로 들어왔는지 확인
- 신속한 대응: 문제 버전을 안전한 버전으로 교체, 재빌드/재배포
- 추가 조치: 브라우저 번들 오염 시 → 캐시 무효화, 사용자 공지
- 로컬/CI 자격증명 탈취 시 → API 키·토큰 즉시 교체(rotate), 로그 점검

### 개발 환경과 배포 환경 보안

- 계정 보안: npm 계정 2FA + 하드웨어 보안키(FIDO), 이메일 MFA
- 내부 저장소 사용: Nexus, Artifactory 같은 프록시 레지스트리로 필터링
- SBOM 관리: 어떤 서비스에 어떤 패키지가 쓰였는지 명확히 기록
- 권한 최소화: npm 토큰, CI 환경 변수는 최소 권한 + 만료 정책
- 사고 대응 프로세스: 영향 범위 식별 → 차단 → 키 교체 → 사용자 공지

### 오픈소스 생태계와 협력

- 유지보수자 지원: Sponsorship, 버그 리포트, 보안 이슈 알림
- 커뮤니티 피드백: 내가 발견한 이상 징후를 신속히 공유
  - 오픈소스 커뮤니티 덕분에 빠르게 이상 징후를 포착하고 문제가 확산하기 전에 차단
  - 오픈소스의 투명성, 대규모 검토, 공개된 방식의 수정 습관이야말로 보안을 보장하는 최적의 장치
- 장기적 관점: 생태계 전체를 건강하게 유지하는 것이 곧 내 서비스 보안으로 이어짐

## 관련 링크

- 광범위한 npm 공급망 공격: 디버그, 분필 및 그 이후의 영향 및 범위 분석: https://www.wiz.io/blog/widespread-npm-supply-chain-attack-breaking-down-impact-scope-across-debug-chalk
- npm 공급망 공격: debug, chalk 및 기타 16개 패키지의 대규모 손상: https://www.upwind.io/feed/npm-supply-chain-attack-massive-compromise-of-debug-chalk-and-16-other-packages
- npm debug / chalk 공급망 공격: 완전 가이드: https://cycode.com/blog/npm-debug-chalk-supply-chain-attack-the-complete-guide
- npm Chalk 및 Debug 패키지가 소프트웨어 공급망 공격에 노출됨: https://www.sonatype.com/blog/npm-chalk-and-debug-packages-hit-in-software-supply-chain-attack
- ESLint Prettier 플러그인 유지 관리자가 npm 공급망 맬웨어를 통해 공격을 받았습니다: https://snyk.io/blog/maintainers-of-eslint-prettier-plugin-attacked-via-npm-supply-chain-malware
- 보안 경고 | NX가 지갑과 자격 증명을 훔치도록 공격당함: https://semgrep.dev/blog/2025/security-alert-nx-compromised-to-steal-wallets-and-credentials
- npm 공급망 공격: Shai Hulud 웜, 8월 Nx 침해로 확대: https://www.upwind.io/feed/npm-supply-chain-attack-shai-hulud-worm-escalates-august-nx-compromise
- NPM 패키지 공격이 남긴 교훈…오픈소스 공급망 보안, 프로세스에 답이 있다: https://www.itworld.co.kr/article/4061327/npm-%ed%8c%a8%ed%82%a4%ec%a7%80-%ea%b3%b5%ea%b2%a9%ec%9d%b4-%eb%82%a8%ea%b8%b4-%ea%b5%90%ed%9b%88%ec%98%a4%ed%94%88%ec%86%8c%ec%8a%a4-%ea%b3%b5%ea%b8%89%eb%a7%9d-%eb%b3%b4%ec%95%88-%ed%94%84.html
